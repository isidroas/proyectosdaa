<!DOCTYPE HTML>
<html>
<head>

<script
  src="https://code.jquery.com/jquery-3.4.1.js"
  integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU="
  crossorigin="anonymous">
</script>

<script>

window.onload = function () {

var dps = []; // dataPoints
var chart = new CanvasJS.Chart("chartContainer", {
	title :{
		text: "Dynamic Data"
	},
	axisY: {
		includeZero: false
	},      
	data: [{
		type: "line",
		dataPoints: dps
	}]
});

var xVal = 0;
var yVal = 100; 
var updateInterval = 1000;
var dataLength = 20; // number of dataPoints visible at any point

var devuelveDatos = function(datosPedidos){
	var datosRecibidos={};
	jQuery.ajax({
		type: 'POST',
		async: false,
		url: "/devuelveDatos",
		data: {datos : ["sensorTemp", "sensorLum"]},
		success: function(datos){datosRecibidos=datos;}
	});
	
	return datosRecibidos 
}

var updateChart = function (count) {

	var datosRecibidos=devuelveDatos('sensorLum')
	console.log(datosRecibidos);
	//yVal = yVal +  Math.round(5 + Math.random() *(-5-5));
	yVal=datosRecibidos.sensorLum.valor;
	dps.push({
		x: xVal,
		y: yVal
	});
	xVal++;

	if (dps.length > dataLength) {
		dps.shift();
	}

	chart.render();
};
console.log(devuelveDatos('sensorTemp'));
updateChart(dataLength);
setInterval(function(){updateChart()}, updateInterval);

}
</script>
</head>
<body>
<div id="chartContainer" style="height: 370px; width:100%;"></div>
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
</body>
</html>
